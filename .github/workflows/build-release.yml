name: Release build

on:
  # manually run
  workflow_dispatch:

jobs:
  build:
    strategy:
      matrix:
        include:
          - target: aarch64-apple-darwin
            host: macos-latest
    runs-on: ${{matrix.host}}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Build
        run: |
          mkdir build
          cd build
          cmake .. \
              -DCMAKE_CFLAGS='-O2 -pipe -flto --target=${{matrix.target}} -static' \
              -DSDL_DEPS_SHARED=off -DSDL_SHARED=off -DSDL_STATIC=on
          make -j
          strip bin/3DASCII
